"use strict";(()=>{var te=Math.pow;var V=Pads.get();var z=new Font("./assets/font/joystix monospace.otf");z.scale=.5;var Gt={WideScreen:1.7777777777777777,NonWideScreen:1.3333333333333333,Fov:.1};var ee=()=>{Render.setView(Gt.WideScreen,Gt.Fov)};var q="srgb",Zt="srgb-linear";var x=class d{constructor(t=0,e=0){d.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){let e=this.x,i=this.y,s=t.elements;return this.x=s[0]*e+s[3]*i+s[6],this.y=s[1]*e+s[4]*i+s[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){let e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}rotateAround(t,e){let i=Math.cos(e),s=Math.sin(e),r=this.x-t.x,o=this.y-t.y;return this.x=r*i-o*s+t.x,this.y=r*s+o*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}};var Me=Math.PI/180,ze=180/Math.PI;function I(d,t,e){return Math.max(t,Math.min(e,d))}function ue(d,t){return(d%t+t)%t}function jt(d,t,e){return(1-e)*d+e*t}var xt=class{constructor(t=0,e=0,i=0,s=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=i,this._w=s}static slerpFlat(t,e,i,s,r,o,n){let h=i[s+0],a=i[s+1],c=i[s+2],l=i[s+3],m=r[o+0],u=r[o+1],p=r[o+2],y=r[o+3];if(n===0){t[e+0]=h,t[e+1]=a,t[e+2]=c,t[e+3]=l;return}if(n===1){t[e+0]=m,t[e+1]=u,t[e+2]=p,t[e+3]=y;return}if(l!==y||h!==m||a!==u||c!==p){let g=1-n,b=h*m+a*u+c*p+l*y,E=b>=0?1:-1,k=1-b*b;if(k>Number.EPSILON){let _=Math.sqrt(k),A=Math.atan2(_,b*E);g=Math.sin(g*A)/_,n=Math.sin(n*A)/_}let F=n*E;if(h=h*g+m*F,a=a*g+u*F,c=c*g+p*F,l=l*g+y*F,g===1-n){let _=1/Math.sqrt(h*h+a*a+c*c+l*l);h*=_,a*=_,c*=_,l*=_}}t[e]=h,t[e+1]=a,t[e+2]=c,t[e+3]=l}static multiplyQuaternionsFlat(t,e,i,s,r,o){let n=i[s],h=i[s+1],a=i[s+2],c=i[s+3],l=r[o],m=r[o+1],u=r[o+2],p=r[o+3];return t[e]=n*p+c*l+h*u-a*m,t[e+1]=h*p+c*m+a*l-n*u,t[e+2]=a*p+c*u+n*m-h*l,t[e+3]=c*p-n*l-h*m-a*u,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,s){return this._x=t,this._y=e,this._z=i,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){let i=t._x,s=t._y,r=t._z,o=t._order,n=Math.cos,h=Math.sin,a=n(i/2),c=n(s/2),l=n(r/2),m=h(i/2),u=h(s/2),p=h(r/2);switch(o){case"XYZ":this._x=m*c*l+a*u*p,this._y=a*u*l-m*c*p,this._z=a*c*p+m*u*l,this._w=a*c*l-m*u*p;break;case"YXZ":this._x=m*c*l+a*u*p,this._y=a*u*l-m*c*p,this._z=a*c*p-m*u*l,this._w=a*c*l+m*u*p;break;case"ZXY":this._x=m*c*l-a*u*p,this._y=a*u*l+m*c*p,this._z=a*c*p+m*u*l,this._w=a*c*l-m*u*p;break;case"ZYX":this._x=m*c*l-a*u*p,this._y=a*u*l+m*c*p,this._z=a*c*p-m*u*l,this._w=a*c*l+m*u*p;break;case"YZX":this._x=m*c*l+a*u*p,this._y=a*u*l+m*c*p,this._z=a*c*p-m*u*l,this._w=a*c*l-m*u*p;break;case"XZY":this._x=m*c*l-a*u*p,this._y=a*u*l-m*c*p,this._z=a*c*p+m*u*l,this._w=a*c*l+m*u*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return e!==!1&&this._onChangeCallback(),this}setFromAxisAngle(t,e){let i=e/2,s=Math.sin(i);return this._x=t.x*s,this._y=t.y*s,this._z=t.z*s,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){let e=t.elements,i=e[0],s=e[4],r=e[8],o=e[1],n=e[5],h=e[9],a=e[2],c=e[6],l=e[10],m=i+n+l;if(m>0){let u=.5/Math.sqrt(m+1);this._w=.25/u,this._x=(c-h)*u,this._y=(r-a)*u,this._z=(o-s)*u}else if(i>n&&i>l){let u=2*Math.sqrt(1+i-n-l);this._w=(c-h)/u,this._x=.25*u,this._y=(s+o)/u,this._z=(r+a)/u}else if(n>l){let u=2*Math.sqrt(1+n-i-l);this._w=(r-a)/u,this._x=(s+o)/u,this._y=.25*u,this._z=(h+c)/u}else{let u=2*Math.sqrt(1+l-i-n);this._w=(o-s)/u,this._x=(r+a)/u,this._y=(h+c)/u,this._z=.25*u}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(I(this.dot(t),-1,1)))}rotateTowards(t,e){let i=this.angleTo(t);if(i===0)return this;let s=Math.min(1,e/i);return this.slerp(t,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){let i=t._x,s=t._y,r=t._z,o=t._w,n=e._x,h=e._y,a=e._z,c=e._w;return this._x=i*c+o*n+s*a-r*h,this._y=s*c+o*h+r*n-i*a,this._z=r*c+o*a+i*h-s*n,this._w=o*c-i*n-s*h-r*a,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);let i=this._x,s=this._y,r=this._z,o=this._w,n=o*t._w+i*t._x+s*t._y+r*t._z;if(n<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,n=-n):this.copy(t),n>=1)return this._w=o,this._x=i,this._y=s,this._z=r,this;let h=1-n*n;if(h<=Number.EPSILON){let u=1-e;return this._w=u*o+e*this._w,this._x=u*i+e*this._x,this._y=u*s+e*this._y,this._z=u*r+e*this._z,this.normalize(),this._onChangeCallback(),this}let a=Math.sqrt(h),c=Math.atan2(a,n),l=Math.sin((1-e)*c)/a,m=Math.sin(e*c)/a;return this._w=o*l+this._w*m,this._x=i*l+this._x*m,this._y=s*l+this._y*m,this._z=r*l+this._z*m,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){let t=Math.random(),e=Math.sqrt(1-t),i=Math.sqrt(t),s=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(e*Math.cos(s),i*Math.sin(r),i*Math.cos(r),e*Math.sin(s))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},N=class d{constructor(t=0,e=0,i=0){d.prototype.isVector3=!0,this.x=t,this.y=e,this.z=i}set(t,e,i){return i===void 0&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(ie.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(ie.setFromAxisAngle(t,e))}applyMatrix3(t){let e=this.x,i=this.y,s=this.z,r=t.elements;return this.x=r[0]*e+r[3]*i+r[6]*s,this.y=r[1]*e+r[4]*i+r[7]*s,this.z=r[2]*e+r[5]*i+r[8]*s,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){let e=this.x,i=this.y,s=this.z,r=t.elements,o=1/(r[3]*e+r[7]*i+r[11]*s+r[15]);return this.x=(r[0]*e+r[4]*i+r[8]*s+r[12])*o,this.y=(r[1]*e+r[5]*i+r[9]*s+r[13])*o,this.z=(r[2]*e+r[6]*i+r[10]*s+r[14])*o,this}applyQuaternion(t){let e=this.x,i=this.y,s=this.z,r=t.x,o=t.y,n=t.z,h=t.w,a=h*e+o*s-n*i,c=h*i+n*e-r*s,l=h*s+r*i-o*e,m=-r*e-o*i-n*s;return this.x=a*h+m*-r+c*-n-l*-o,this.y=c*h+m*-o+l*-r-a*-n,this.z=l*h+m*-n+a*-o-c*-r,this}transformDirection(t){let e=this.x,i=this.y,s=this.z,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*s,this.y=r[1]*e+r[5]*i+r[9]*s,this.z=r[2]*e+r[6]*i+r[10]*s,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){let i=t.x,s=t.y,r=t.z,o=e.x,n=e.y,h=e.z;return this.x=s*h-r*n,this.y=r*o-i*h,this.z=i*n-s*o,this}projectOnVector(t){let e=t.lengthSq();if(e===0)return this.set(0,0,0);let i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return Ht.copy(this).projectOnVector(t),this.sub(Ht)}reflect(t){return this.sub(Ht.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){let e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;let i=this.dot(t)/e;return Math.acos(I(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){let e=this.x-t.x,i=this.y-t.y,s=this.z-t.z;return e*e+i*i+s*s}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){let s=Math.sin(e)*t;return this.x=s*Math.sin(i),this.y=Math.cos(e)*t,this.z=s*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){let e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){let e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),s=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=s,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let t=(Math.random()-.5)*2,e=Math.random()*Math.PI*2,i=Math.sqrt(1-te(t,2));return this.x=i*Math.cos(e),this.y=i*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}},Ht=new N,ie=new xt,se=new x,P=class{constructor(t=new x(1/0,1/0),e=new x(-1/0,-1/0)){this.isBox2=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){let i=se.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t=new x){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t=new x){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return se.copy(t).clamp(this.min,this.max).sub(t).length()}intersect(t){return this.min.max(t.min),this.max.min(t.max),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}};function dt(d){return d<.04045?d*.0773993808:Math.pow(d*.9478672986+.0521327014,2.4)}function pt(d){return d<.0031308?d*12.92:1.055*Math.pow(d,.41666)-.055}var Ot={[q]:{[Zt]:dt},[Zt]:{[q]:pt}},C={legacyMode:!0,get workingColorSpace(){return Zt},set workingColorSpace(d){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(d,t,e){if(this.legacyMode||t===e||!t||!e)return d;if(Ot[t]&&Ot[t][e]!==void 0){let i=Ot[t][e];return d.r=i(d.r),d.g=i(d.g),d.b=i(d.b),d}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(d,t){return this.convert(d,this.workingColorSpace,t)},toWorkingColorSpace:function(d,t){return this.convert(d,t,this.workingColorSpace)}},oe={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},M={r:0,g:0,b:0},R={h:0,s:0,l:0},lt={h:0,s:0,l:0};function Wt(d,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?d+(t-d)*6*e:e<1/2?t:e<2/3?d+(t-d)*6*(2/3-e):d}function ut(d,t){return t.r=d.r,t.g=d.g,t.b=d.b,t}var $t=class{constructor(t,e,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,e===void 0&&i===void 0?this.set(t):this.setRGB(t,e,i)}set(t){return t&&t.isColor?this.copy(t):typeof t=="number"?this.setHex(t):typeof t=="string"&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=q){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,C.toWorkingColorSpace(this,e),this}setRGB(t,e,i,s=C.workingColorSpace){return this.r=t,this.g=e,this.b=i,C.toWorkingColorSpace(this,s),this}setHSL(t,e,i,s=C.workingColorSpace){if(t=ue(t,1),e=I(e,0,1),i=I(i,0,1),e===0)this.r=this.g=this.b=i;else{let r=i<=.5?i*(1+e):i+e-i*e,o=2*i-r;this.r=Wt(o,r,t+1/3),this.g=Wt(o,r,t),this.b=Wt(o,r,t-1/3)}return C.toWorkingColorSpace(this,s),this}setStyle(t,e=q){function i(r){r!==void 0&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let s;if(s=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let r,o=s[1],n=s[2];switch(o){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,C.toWorkingColorSpace(this,e),i(r[4]),this;if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,C.toWorkingColorSpace(this,e),i(r[4]),this;break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n)){let h=parseFloat(r[1])/360,a=parseFloat(r[2])/100,c=parseFloat(r[3])/100;return i(r[4]),this.setHSL(h,a,c,e)}break}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(t)){let r=s[1],o=r.length;if(o===3)return this.r=parseInt(r.charAt(0)+r.charAt(0),16)/255,this.g=parseInt(r.charAt(1)+r.charAt(1),16)/255,this.b=parseInt(r.charAt(2)+r.charAt(2),16)/255,C.toWorkingColorSpace(this,e),this;if(o===6)return this.r=parseInt(r.charAt(0)+r.charAt(1),16)/255,this.g=parseInt(r.charAt(2)+r.charAt(3),16)/255,this.b=parseInt(r.charAt(4)+r.charAt(5),16)/255,C.toWorkingColorSpace(this,e),this}return t&&t.length>0?this.setColorName(t,e):this}setColorName(t,e=q){let i=oe[t.toLowerCase()];return i!==void 0?this.setHex(i,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=dt(t.r),this.g=dt(t.g),this.b=dt(t.b),this}copyLinearToSRGB(t){return this.r=pt(t.r),this.g=pt(t.g),this.b=pt(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=q){return C.fromWorkingColorSpace(ut(this,M),t),I(M.r*255,0,255)<<16^I(M.g*255,0,255)<<8^I(M.b*255,0,255)<<0}getHexString(t=q){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=C.workingColorSpace){C.fromWorkingColorSpace(ut(this,M),e);let i=M.r,s=M.g,r=M.b,o=Math.max(i,s,r),n=Math.min(i,s,r),h,a,c=(n+o)/2;if(n===o)h=0,a=0;else{let l=o-n;switch(a=c<=.5?l/(o+n):l/(2-o-n),o){case i:h=(s-r)/l+(s<r?6:0);break;case s:h=(r-i)/l+2;break;case r:h=(i-s)/l+4;break}h/=6}return t.h=h,t.s=a,t.l=c,t}getRGB(t,e=C.workingColorSpace){return C.fromWorkingColorSpace(ut(this,M),e),t.r=M.r,t.g=M.g,t.b=M.b,t}getStyle(t=q){return C.fromWorkingColorSpace(ut(this,M),t),t!==q?`color(${t} ${M.r} ${M.g} ${M.b})`:`rgb(${M.r*255|0},${M.g*255|0},${M.b*255|0})`}offsetHSL(t,e,i){return this.getHSL(R),R.h+=t,R.s+=e,R.l+=i,this.setHSL(R.h,R.s,R.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,i){return this.r=t.r+(e.r-t.r)*i,this.g=t.g+(e.g-t.g)*i,this.b=t.b+(e.b-t.b)*i,this}lerpHSL(t,e){this.getHSL(R),t.getHSL(lt);let i=jt(R.h,lt.h,e),s=jt(R.s,lt.s,e),r=jt(R.l,lt.l,e);return this.setHSL(i,s,r),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};$t.NAMES=oe;var yt=class d{constructor(){d.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(t,e,i,s,r,o,n,h,a,c,l,m,u,p,y,g){let b=this.elements;return b[0]=t,b[4]=e,b[8]=i,b[12]=s,b[1]=r,b[5]=o,b[9]=n,b[13]=h,b[2]=a,b[6]=c,b[10]=l,b[14]=m,b[3]=u,b[7]=p,b[11]=y,b[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new d().fromArray(this.elements)}copy(t){let e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){let e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){let e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){let e=this.elements,i=t.elements,s=1/H.setFromMatrixColumn(t,0).length(),r=1/H.setFromMatrixColumn(t,1).length(),o=1/H.setFromMatrixColumn(t,2).length();return e[0]=i[0]*s,e[1]=i[1]*s,e[2]=i[2]*s,e[3]=0,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=0,e[8]=i[8]*o,e[9]=i[9]*o,e[10]=i[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){let e=this.elements,i=t.x,s=t.y,r=t.z,o=Math.cos(i),n=Math.sin(i),h=Math.cos(s),a=Math.sin(s),c=Math.cos(r),l=Math.sin(r);if(t.order==="XYZ"){let m=o*c,u=o*l,p=n*c,y=n*l;e[0]=h*c,e[4]=-h*l,e[8]=a,e[1]=u+p*a,e[5]=m-y*a,e[9]=-n*h,e[2]=y-m*a,e[6]=p+u*a,e[10]=o*h}else if(t.order==="YXZ"){let m=h*c,u=h*l,p=a*c,y=a*l;e[0]=m+y*n,e[4]=p*n-u,e[8]=o*a,e[1]=o*l,e[5]=o*c,e[9]=-n,e[2]=u*n-p,e[6]=y+m*n,e[10]=o*h}else if(t.order==="ZXY"){let m=h*c,u=h*l,p=a*c,y=a*l;e[0]=m-y*n,e[4]=-o*l,e[8]=p+u*n,e[1]=u+p*n,e[5]=o*c,e[9]=y-m*n,e[2]=-o*a,e[6]=n,e[10]=o*h}else if(t.order==="ZYX"){let m=o*c,u=o*l,p=n*c,y=n*l;e[0]=h*c,e[4]=p*a-u,e[8]=m*a+y,e[1]=h*l,e[5]=y*a+m,e[9]=u*a-p,e[2]=-a,e[6]=n*h,e[10]=o*h}else if(t.order==="YZX"){let m=o*h,u=o*a,p=n*h,y=n*a;e[0]=h*c,e[4]=y-m*l,e[8]=p*l+u,e[1]=l,e[5]=o*c,e[9]=-n*c,e[2]=-a*c,e[6]=u*l+p,e[10]=m-y*l}else if(t.order==="XZY"){let m=o*h,u=o*a,p=n*h,y=n*a;e[0]=h*c,e[4]=-l,e[8]=a*c,e[1]=m*l+y,e[5]=o*c,e[9]=u*l-p,e[2]=p*l-u,e[6]=n*c,e[10]=y*l+m}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(me,t,de)}lookAt(t,e,i){let s=this.elements;return B.subVectors(t,e),B.lengthSq()===0&&(B.z=1),B.normalize(),X.crossVectors(i,B),X.lengthSq()===0&&(Math.abs(i.z)===1?B.x+=1e-4:B.z+=1e-4,B.normalize(),X.crossVectors(i,B)),X.normalize(),mt.crossVectors(B,X),s[0]=X.x,s[4]=mt.x,s[8]=B.x,s[1]=X.y,s[5]=mt.y,s[9]=B.y,s[2]=X.z,s[6]=mt.z,s[10]=B.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){let i=t.elements,s=e.elements,r=this.elements,o=i[0],n=i[4],h=i[8],a=i[12],c=i[1],l=i[5],m=i[9],u=i[13],p=i[2],y=i[6],g=i[10],b=i[14],E=i[3],k=i[7],F=i[11],_=i[15],A=s[0],f=s[4],Y=s[8],Q=s[12],K=s[1],J=s[5],tt=s[9],et=s[13],it=s[2],st=s[6],rt=s[10],nt=s[14],ot=s[3],ht=s[7],at=s[11],ct=s[15];return r[0]=o*A+n*K+h*it+a*ot,r[4]=o*f+n*J+h*st+a*ht,r[8]=o*Y+n*tt+h*rt+a*at,r[12]=o*Q+n*et+h*nt+a*ct,r[1]=c*A+l*K+m*it+u*ot,r[5]=c*f+l*J+m*st+u*ht,r[9]=c*Y+l*tt+m*rt+u*at,r[13]=c*Q+l*et+m*nt+u*ct,r[2]=p*A+y*K+g*it+b*ot,r[6]=p*f+y*J+g*st+b*ht,r[10]=p*Y+y*tt+g*rt+b*at,r[14]=p*Q+y*et+g*nt+b*ct,r[3]=E*A+k*K+F*it+_*ot,r[7]=E*f+k*J+F*st+_*ht,r[11]=E*Y+k*tt+F*rt+_*at,r[15]=E*Q+k*et+F*nt+_*ct,this}multiplyScalar(t){let e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){let t=this.elements,e=t[0],i=t[4],s=t[8],r=t[12],o=t[1],n=t[5],h=t[9],a=t[13],c=t[2],l=t[6],m=t[10],u=t[14],p=t[3],y=t[7],g=t[11],b=t[15];return p*(+r*h*l-s*a*l-r*n*m+i*a*m+s*n*u-i*h*u)+y*(+e*h*u-e*a*m+r*o*m-s*o*u+s*a*c-r*h*c)+g*(+e*a*l-e*n*u-r*o*l+i*o*u+r*n*c-i*a*c)+b*(-s*n*c-e*h*l+e*n*m+s*o*l-i*o*m+i*h*c)}transpose(){let t=this.elements,e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){let s=this.elements;return t.isVector3?(s[12]=t.x,s[13]=t.y,s[14]=t.z):(s[12]=t,s[13]=e,s[14]=i),this}invert(){let t=this.elements,e=t[0],i=t[1],s=t[2],r=t[3],o=t[4],n=t[5],h=t[6],a=t[7],c=t[8],l=t[9],m=t[10],u=t[11],p=t[12],y=t[13],g=t[14],b=t[15],E=l*g*a-y*m*a+y*h*u-n*g*u-l*h*b+n*m*b,k=p*m*a-c*g*a-p*h*u+o*g*u+c*h*b-o*m*b,F=c*y*a-p*l*a+p*n*u-o*y*u-c*n*b+o*l*b,_=p*l*h-c*y*h-p*n*m+o*y*m+c*n*g-o*l*g,A=e*E+i*k+s*F+r*_;if(A===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let f=1/A;return t[0]=E*f,t[1]=(y*m*r-l*g*r-y*s*u+i*g*u+l*s*b-i*m*b)*f,t[2]=(n*g*r-y*h*r+y*s*a-i*g*a-n*s*b+i*h*b)*f,t[3]=(l*h*r-n*m*r-l*s*a+i*m*a+n*s*u-i*h*u)*f,t[4]=k*f,t[5]=(c*g*r-p*m*r+p*s*u-e*g*u-c*s*b+e*m*b)*f,t[6]=(p*h*r-o*g*r-p*s*a+e*g*a+o*s*b-e*h*b)*f,t[7]=(o*m*r-c*h*r+c*s*a-e*m*a-o*s*u+e*h*u)*f,t[8]=F*f,t[9]=(p*l*r-c*y*r-p*i*u+e*y*u+c*i*b-e*l*b)*f,t[10]=(o*y*r-p*n*r+p*i*a-e*y*a-o*i*b+e*n*b)*f,t[11]=(c*n*r-o*l*r-c*i*a+e*l*a+o*i*u-e*n*u)*f,t[12]=_*f,t[13]=(c*y*s-p*l*s+p*i*m-e*y*m-c*i*g+e*l*g)*f,t[14]=(p*n*s-o*y*s-p*i*h+e*y*h+o*i*g-e*n*g)*f,t[15]=(o*l*s-c*n*s+c*i*h-e*l*h-o*i*m+e*n*m)*f,this}scale(t){let e=this.elements,i=t.x,s=t.y,r=t.z;return e[0]*=i,e[4]*=s,e[8]*=r,e[1]*=i,e[5]*=s,e[9]*=r,e[2]*=i,e[6]*=s,e[10]*=r,e[3]*=i,e[7]*=s,e[11]*=r,this}getMaxScaleOnAxis(){let t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],s=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,s))}makeTranslation(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){let e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){let e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){let e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){let i=Math.cos(e),s=Math.sin(e),r=1-i,o=t.x,n=t.y,h=t.z,a=r*o,c=r*n;return this.set(a*o+i,a*n-s*h,a*h+s*n,0,a*n+s*h,c*n+i,c*h-s*o,0,a*h-s*n,c*h+s*o,r*h*h+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,s,r,o){return this.set(1,i,r,0,t,1,o,0,e,s,1,0,0,0,0,1),this}compose(t,e,i){let s=this.elements,r=e._x,o=e._y,n=e._z,h=e._w,a=r+r,c=o+o,l=n+n,m=r*a,u=r*c,p=r*l,y=o*c,g=o*l,b=n*l,E=h*a,k=h*c,F=h*l,_=i.x,A=i.y,f=i.z;return s[0]=(1-(y+b))*_,s[1]=(u+F)*_,s[2]=(p-k)*_,s[3]=0,s[4]=(u-F)*A,s[5]=(1-(m+b))*A,s[6]=(g+E)*A,s[7]=0,s[8]=(p+k)*f,s[9]=(g-E)*f,s[10]=(1-(m+y))*f,s[11]=0,s[12]=t.x,s[13]=t.y,s[14]=t.z,s[15]=1,this}decompose(t,e,i){let s=this.elements,r=H.set(s[0],s[1],s[2]).length(),o=H.set(s[4],s[5],s[6]).length(),n=H.set(s[8],s[9],s[10]).length();this.determinant()<0&&(r=-r),t.x=s[12],t.y=s[13],t.z=s[14],L.copy(this);let a=1/r,c=1/o,l=1/n;return L.elements[0]*=a,L.elements[1]*=a,L.elements[2]*=a,L.elements[4]*=c,L.elements[5]*=c,L.elements[6]*=c,L.elements[8]*=l,L.elements[9]*=l,L.elements[10]*=l,e.setFromRotationMatrix(L),i.x=r,i.y=o,i.z=n,this}makePerspective(t,e,i,s,r,o){let n=this.elements,h=2*r/(e-t),a=2*r/(i-s),c=(e+t)/(e-t),l=(i+s)/(i-s),m=-(o+r)/(o-r),u=-2*o*r/(o-r);return n[0]=h,n[4]=0,n[8]=c,n[12]=0,n[1]=0,n[5]=a,n[9]=l,n[13]=0,n[2]=0,n[6]=0,n[10]=m,n[14]=u,n[3]=0,n[7]=0,n[11]=-1,n[15]=0,this}makeOrthographic(t,e,i,s,r,o){let n=this.elements,h=1/(e-t),a=1/(i-s),c=1/(o-r),l=(e+t)*h,m=(i+s)*a,u=(o+r)*c;return n[0]=2*h,n[4]=0,n[8]=0,n[12]=-l,n[1]=0,n[5]=2*a,n[9]=0,n[13]=-m,n[2]=0,n[6]=0,n[10]=-2*c,n[14]=-u,n[3]=0,n[7]=0,n[11]=0,n[15]=1,this}equals(t){let e=this.elements,i=t.elements;for(let s=0;s<16;s++)if(e[s]!==i[s])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){let i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}},H=new N,L=new yt,me=new N(0,0,0),de=new N(1,1,1),X=new N,mt=new N,B=new N,re=new yt,ne=new xt,bt=class d{constructor(t=0,e=0,i=0,s=d.DefaultOrder){this.isEuler=!0,this._x=t,this._y=e,this._z=i,this._order=s}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,s=this._order){return this._x=t,this._y=e,this._z=i,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,i=!0){let s=t.elements,r=s[0],o=s[4],n=s[8],h=s[1],a=s[5],c=s[9],l=s[2],m=s[6],u=s[10];switch(e){case"XYZ":this._y=Math.asin(I(n,-1,1)),Math.abs(n)<.9999999?(this._x=Math.atan2(-c,u),this._z=Math.atan2(-o,r)):(this._x=Math.atan2(m,a),this._z=0);break;case"YXZ":this._x=Math.asin(-I(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(n,u),this._z=Math.atan2(h,a)):(this._y=Math.atan2(-l,r),this._z=0);break;case"ZXY":this._x=Math.asin(I(m,-1,1)),Math.abs(m)<.9999999?(this._y=Math.atan2(-l,u),this._z=Math.atan2(-o,a)):(this._y=0,this._z=Math.atan2(h,r));break;case"ZYX":this._y=Math.asin(-I(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(m,u),this._z=Math.atan2(h,r)):(this._x=0,this._z=Math.atan2(-o,a));break;case"YZX":this._z=Math.asin(I(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(-c,a),this._y=Math.atan2(-l,r)):(this._x=0,this._y=Math.atan2(n,u));break;case"XZY":this._z=Math.asin(-I(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(m,a),this._y=Math.atan2(n,r)):(this._x=Math.atan2(-c,u),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,i===!0&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return re.makeRotationFromQuaternion(t),this.setFromRotationMatrix(re,e,i)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return ne.setFromEuler(this),this.setFromQuaternion(ne,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}};bt.DefaultOrder="XYZ";bt.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];var Yt={zBuffering:!0,psmz:Screen.Z16};var Z=Screen.getMode(),he=()=>{Z.zbuffering=Yt.zBuffering,Z.psmz=Yt.psmz,Screen.setMode(Z)},T=new x(Z.width,Z.height),Qt=T.clone().divideScalar(2);var Kt=class{constructor(){this.position=new x(0,0);this.screenOffset=new x(Qt.x,Qt.y)}setPosition(t){this.position=t}getPosition(){return this.position.clone()}getHitBox(){return new P(this.position,this.position.clone().add(T))}getClippingAABB(){let t=this.toWorldSpace(new x(0,0)),e=this.toWorldSpace(T);return new P(t,e)}toScreenSpace(t){return t.clone().sub(this.position).add(this.screenOffset)}toWorldSpace(t){return t.clone().sub(this.screenOffset).add(this.position)}},w=new Kt;var U=class U{constructor(){let t=this.constructor;if(U._instances.has(t))throw new Error(`Cannot instantiate ${t.name} directly - use getInstance()`)}static getInstance(){return U._instances.has(this)||U._instances.set(this,new this),U._instances.get(this)}static clearInstance(){U._instances.delete(this)}};U._instances=new Map;var G=U;var gt=class extends G{constructor(){super();this.textures=new Map;this.pathToID=new Map;this.nextID=1}loadTexture(e){if(this.pathToID.has(e))return this.pathToID.get(e);let i=new Image(e),s=this.nextID++;return this.textures.set(s,i),this.pathToID.set(e,s),s}getTexture(e){if(!this.textures.has(e))throw new Error(`Texture not found for id: ${e}!`);return this.textures.get(e)}},S=gt,ve=gt.getInstance();var ft=class d{constructor(t,e=0){this.bounds={x:t.x||0,y:t.y||0,width:t.width,height:t.height},this.maxObjects=typeof t.maxObjects=="number"?t.maxObjects:10,this.maxLevels=typeof t.maxLevels=="number"?t.maxLevels:4,this.level=e,this.objects=[],this.nodes=[]}getIndex(t){return t.qtIndex(this.bounds)}split(){let t=this.level+1,e=this.bounds.width/2,i=this.bounds.height/2,s=this.bounds.x,r=this.bounds.y,o=[{x:s+e,y:r},{x:s,y:r},{x:s,y:r+i},{x:s+e,y:r+i}];for(let n=0;n<4;n++)this.nodes[n]=new d({x:o[n].x,y:o[n].y,width:e,height:i,maxObjects:this.maxObjects,maxLevels:this.maxLevels},t)}insert(t){if(this.nodes.length){let e=this.getIndex(t);for(let i=0;i<e.length;i++)this.nodes[e[i]].insert(t);return}if(this.objects.push(t),this.objects.length>this.maxObjects&&this.level<this.maxLevels){this.nodes.length||this.split();for(let e=0;e<this.objects.length;e++){let i=this.getIndex(this.objects[e]);for(let s=0;s<i.length;s++)this.nodes[i[s]].insert(this.objects[e])}this.objects=[]}}retrieve(t){let e=this.getIndex(t),i=this.objects;if(this.nodes.length)for(let s=0;s<e.length;s++)i=i.concat(this.nodes[e[s]].retrieve(t));return this.level===0?Array.from(new Set(i)):i}remove(t,e=!1){let i=this.objects.indexOf(t);i>-1&&this.objects.splice(i,1);for(let s=0;s<this.nodes.length;s++)this.nodes[s].remove(t);return this.level===0&&!e&&this.join(),i!==-1}update(t,e=!1){this.remove(t,e),this.insert(t)}join(){let t=Array.from(this.objects);for(let i=0;i<this.nodes.length;i++){let s=this.nodes[i].join();t=t.concat(s)}let e=Array.from(new Set(t));if(e.length<=this.maxObjects){this.objects=e;for(let i=0;i<this.nodes.length;i++)this.nodes[i].objects=[];this.nodes=[]}return t}clear(){this.objects=[];for(let t=0;t<this.nodes.length;t++)this.nodes.length&&this.nodes[t].clear();this.nodes=[]}},D=class{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.data=t.data}qtIndex(t){let e=[],i=t.x+t.width/2,s=t.y+t.height/2,r=this.y<s,o=this.x<i,n=this.x+this.width>i,h=this.y+this.height>s;return r&&n&&e.push(0),o&&r&&e.push(1),o&&h&&e.push(2),n&&h&&e.push(3),e}},wt=class d{constructor(t){this.x=t.x,this.y=t.y,this.r=t.r,this.data=t.data}qtIndex(t){let e=[],i=t.width/2,s=t.height/2,r=t.x+i,o=t.y+s,n=[[r,t.y],[t.x,t.y],[t.x,o],[r,o]];for(let h=0;h<n.length;h++)d.intersectRect(this.x,this.y,this.r,n[h][0],n[h][1],n[h][0]+i,n[h][1]+s)&&e.push(h);return e}static intersectRect(t,e,i,s,r,o,n){let h=t-Math.max(s,Math.min(t,o)),a=e-Math.max(r,Math.min(e,n));return h*h+a*a<i*i}};var O=class{constructor(){this.id=-1;this.textureId=-1;this.tileIndex=0;this.velocity=new x(0,0);this.direction=new x(0,0);this.position_start=new x(0,0);this.position_end=new x(0,0);this.position=new x(0,0)}};var Jt={FPS_5:1e3/5,FPS_10:1e3/10,FPS_15:1e3/15,FPS_20:1e3/20,FPS_30:1e3/30,FPS_60:1e3/60,FPS_120:1e3/120},j=class extends G{constructor(e=Jt.FPS_15,i=Jt.FPS_30){super();this.timer=Timer.new();this.deltaTime=0;this.lastTime=0;this.lastRenderTime=0;this.lastUpdateTime=0;this.renderTime=0;this.updateTime=0;this.maxStepsPerFrame=3;this.maxAccumulatedTime=Jt.FPS_20;this.updateTracker={accumulator:0,frameLimit:0,steps:0};this.renderTracker={accumulator:0,frameLimit:0,steps:0};this.lastTime=Timer.getTime(this.timer)/1e3,this.updateTracker.frameLimit=e,this.updateTracker.accumulator=0,this.renderTracker.frameLimit=i,this.renderTracker.accumulator=-i/(i/e),this.lastUpdateTime=this.lastTime,this.lastRenderTime=this.lastTime,console.log(`updateFrameLimit: ${this.updateTracker.frameLimit}`),console.log(`renderFrameLimit: ${this.renderTracker.frameLimit}`)}get DeltaTime(){return this.deltaTime}get FPS(){return Math.floor(1e3/this.deltaTime)}get RenderTime(){return this.renderTime/1e3}get UpdateTime(){return this.updateTime/1e3}get Lerp(){return this.updateTracker.accumulator/this.updateTracker.frameLimit}update(e,i,s){let r=Timer.getTime(this.timer);for(this.deltaTime=(r-this.lastTime)/1e3,this.lastTime=r,this.updateTracker.steps=0,this.renderTracker.steps=0,e(this.deltaTime),this.updateTracker.accumulator=Math.min(this.updateTracker.accumulator+this.deltaTime,this.updateTracker.frameLimit);this.updateTracker.accumulator>=this.updateTracker.frameLimit&&this.updateTracker.steps<this.maxStepsPerFrame;)i(this.updateTracker.frameLimit),this.updateTracker.accumulator-=this.updateTracker.frameLimit,this.updateTime=r-this.lastUpdateTime,this.lastUpdateTime=r,this.updateTracker.steps++;for(this.renderTracker.accumulator=Math.min(this.renderTracker.accumulator+this.deltaTime,this.renderTracker.frameLimit);this.renderTracker.accumulator>=this.renderTracker.frameLimit&&this.renderTracker.steps<this.maxStepsPerFrame;)s(),this.renderTracker.accumulator-=this.renderTracker.frameLimit,this.renderTime=r-this.lastRenderTime,this.lastRenderTime=r,this.renderTracker.steps++}setUpdateFrameLimit(e){this.updateTracker.frameLimit=e}setRenderFrameLimit(e){this.renderTracker.frameLimit=e}};var _t=class{static LevelUp(t){t.level++,t.XP-=t.xpToNextLevel,t.xpToNextLevel=Math.floor(t.xpToNextLevel*1.1)}};var Mt=class extends O{constructor(){super();this.hitboxSize=new x(20,32);this.tileSize=new x(32,32);this.health=100;this.maxHealth=100;this.collidable_type=0;this.level=1;this.XP=0;this.xpToNextLevel=100;this.magnetOrbMultiplyer=1;this.magnetOrb=32;this.hitBox=new P(new x(0,0),new x(0,0));this._isMooving=!1;this.speed=150,this.elapsedAnimationTime=0,this.animationSpeed=80;let e=S.getInstance();this.textureId=e.loadTexture("./assets/sprites/player/kid-male-spritesheet.png"),this.texture_atlas=e.getTexture(this.textureId)}qtIndex(e){return D.prototype.qtIndex.call({x:this.position.x,y:this.position.y,width:this.hitboxSize.x,height:this.hitboxSize.y},e)}update(e){this.position.lerpVectors(this.position_start,this.position_end,j.getInstance().Lerp),V.lx+V.ly!=0?this.setRunning():this.setIdle();let i=0,s=0;V.lx>0&&(i=1),V.lx<0&&(i=-1),V.ly>0&&(s=1),V.ly<0&&(s=-1),this.direction.x=i,this.direction.y=s}fixedUpdate(e){this.position_start.copy(this.position_end),this.elapsedAnimationTime+=e,this.elapsedAnimationTime>=this.animationSpeed&&(this.updateSprite(),this.elapsedAnimationTime=0);let i=V.lx/128,s=V.ly/128;this.velocity.x=i*this.speed*e/1e3,this.velocity.y=s*this.speed*e/1e3,this.position_end.add(this.velocity),this.hitBox.setFromCenterAndSize(this.position_end,this.hitboxSize)}render(){let e=this.direction.x==-1,s=this.tileIndex*this.tileSize.x,r=s+this.tileSize.x,o=0,n=this.tileSize.y;this.texture_atlas.startx=e?r:s,this.texture_atlas.endx=e?s:r,this.texture_atlas.starty=o,this.texture_atlas.endy=n,this.texture_atlas.width=this.tileSize.x,this.texture_atlas.height=this.tileSize.y;let h=w.toScreenSpace(this.position).sub(this.tileSize.clone().divideScalar(2));this.texture_atlas.draw(h.x,h.y)}renderHP(){let e=new x(0,20),i=new x(22,5),s=i.clone().subScalar(2),r=w.toScreenSpace(this.position).add(e).sub(i.clone().divideScalar(2));Draw.rect(r.x,r.y,i.x,i.y,Color.new(0,0,0,128));let o=w.toScreenSpace(this.position).add(e).sub(s.clone().divideScalar(2)),n=s.x*(this.health/this.maxHealth);Draw.rect(o.x,o.y,n,s.y,Color.new(200,0,0,128))}renderXP(){let e=new x(0,T.y-10),i=new x(T.x,10),s=e.clone();Draw.rect(s.x,s.y,i.x,i.y,Color.new(120,120,120,128));let r=new x(4,4),o=e.clone().add(r.clone().divideScalar(2)),n=i.x*(this.XP/this.xpToNextLevel)-r.x;Draw.rect(o.x,o.y,n,i.y-r.y,Color.new(255,230,0,128));let h=z.color,a=z.scale,c=Color.new(0,0,0,128);z.color=c,z.scale=.45,z.print(5,T.y-9,`XP: ${this.XP} / ${this.xpToNextLevel}`),z.print(T.x-100,T.y-9,`Lvl:  ${this.level}`),z.color=h,z.scale=a}renderHitBox(){let e=w.toScreenSpace(this.hitBox.min.clone());Draw.rect(e.x,e.y,this.hitboxSize.x,this.hitboxSize.y,Color.new(255,0,0,128))}isMooving(){return this._isMooving}updateSprite(){if(this.tileIndex++,this.isMooving()){this.tileIndex%=6,this.tileIndex+=6;return}this.tileIndex%=6}setIdle(){this._isMooving=!1}setRunning(){this._isMooving=!0}getHealth(){return this.health}takeDamage(e){this.health-=e,this.health<0&&(this.health=0)}isAlive(){return this.health>0}onCollectXp(e){this.XP+=e,this.XP>=this.xpToNextLevel&&(_t.LevelUp(this),this.onLeveUp&&this.onLeveUp())}get magnetOrbRange(){return this.magnetOrb*this.magnetOrbMultiplyer}};var zt=class{constructor(){}};var v=class extends O{constructor(e,i){super();this.collidable_type=1;this.animationSpeed=500;this.speed=50;this.velocity=new x(0,0);this.direction=new x(0,0);this.position=new x(0,0);this.hitBox=new P(new x(0,0),new x(0,0));this.position.x=e,this.position.y=i,this.position_start.copy(this.position),this.position_end.copy(this.position),this.elapsedAnimationTime=0}getHealth(){return this.health}takeDamage(e){this.health-=e,this.health<0&&(this.health=0)}isAlive(){return this.health>0}qtIndex(e){return D.prototype.qtIndex.call({x:this.position.x,y:this.position.y,width:this.hitboxSize.x,height:this.hitboxSize.y},e)}update(e){this.position.lerpVectors(this.position_start,this.position_end,j.getInstance().Lerp)}render(){}setDirection(e){this.direction=e.clone().sub(this.position).normalize()}fixedUpdate(e){this.position_start.copy(this.position_end),this.elapsedAnimationTime+=e,this.elapsedAnimationTime>=this.animationSpeed&&(this.updateSprite(),this.elapsedAnimationTime=0);let i=this.speed*e/1e3;this.velocity.addScalar(i).clampScalar(-i,i),this.position_end.add(this.direction.clone().multiply(this.velocity)),this.hitBox.setFromCenterAndSize(this.position_end,this.hitboxSize)}renderHitBox(){let e=w.toScreenSpace(this.hitBox.min.clone());Draw.rect(e.x,e.y,this.hitboxSize.x,this.hitboxSize.y,Color.new(255,0,0,128))}applyDamage(e){e.takeDamage(this.damage)}};var St=class extends v{constructor(e,i){super(e,i);this.tileSize=new x(64,64);this.hitboxSize=new x(20,40);this.damage=7;this.health=15;this.maxHealth=15;this.speed=25,this.animationSpeed=150}updateSprite(){this.tileIndex++,this.tileIndex%=6}};var Ft=class extends v{constructor(e,i){super(e,i);this.tileSize=new x(64,64);this.hitboxSize=new x(42,43);this.damage=7;this.health=10;this.maxHealth=10;this.speed=30,this.animationSpeed=200}updateSprite(){this.tileIndex++,this.tileIndex%=4}};var Ct=class extends v{constructor(e,i){super(e,i);this.tileSize=new x(64,64);this.hitboxSize=new x(40,30);this.damage=5;this.health=5;this.maxHealth=5;this.speed=40,this.animationSpeed=200}updateSprite(){this.tileIndex++,this.tileIndex%=4}};var Tt=class extends v{constructor(e,i){super(e,i);this.tileSize=new x(64,64);this.hitboxSize=new x(28,35);this.damage=5;this.health=7;this.maxHealth=7;this.speed=25,this.animationSpeed=250,this.tileSize.x=64,this.tileSize.y=64}updateSprite(){this.tileIndex++,this.tileIndex%=5}};var At=class extends v{constructor(e,i){super(e,i);this.tileSize=new x(64,64);this.hitboxSize=new x(40,32);this.damage=2;this.health=5;this.maxHealth=5;this.speed=40,this.animationSpeed=200}updateSprite(){this.tileIndex++,this.tileIndex%=4}};var W=class{constructor(){this.quadTree=new ft({width:5e3,height:5e3,x:-2500,y:-2500,maxObjects:4})}insert(t){this.quadTree.insert(t)}clear(){this.quadTree.clear()}intersects(t){return this.quadTree.retrieve(t)}};function ce(d,t){return d+Math.floor(Math.random()*(t-d+1))}var Et=class{constructor(){this.maxVelocity=10;this.id=-1;this.textureId=-1;this.collected=!1;this.attracting=!1;this.collidable_type=2;this.velocity=new x(0,0);this.direction=new x(0,0);this.position=new x(0,0)}setDirectionFromTarget(t){this.direction.copy(t.clone().sub(this.position).normalize())}getExpandedAABB(){return this.aabb.clone().expandByVector(this.velocity)}qtIndex(t){return D.prototype.qtIndex.call({x:this.position.x-this.size.x/2,y:this.position.y-this.size.y/2,width:this.size.x,height:this.size.y},t)}};var kt=class extends W{constructor(){super();this.id_counter=1;this.enemies=[];this.TextureRepository={Clown:0,DemonDoor:0,Homework:0,FourEyesBug:0,Ghost:0};this.getRandomPositionAtScreemBorder=(e,i,s,r,o)=>{let n=e-o,h=i+o,a=s-o,c=r+o,l=Math.floor(Math.random()*4),m=n,u=a;switch(l){case 0:m=Math.random()*(h-n)+n,u=a;break;case 1:m=h,u=Math.random()*(c-a)+a;break;case 2:m=Math.random()*(h-n)+n,u=c;break;case 3:m=n,u=Math.random()*(c-a)+a;break}return new x(m,u)};this.registerTextures()}get enemiesCounter(){return this.enemies.length}registerTextures(){let e=S.getInstance();this.TextureRepository.Clown=e.loadTexture("./assets/sprites/enemies/clown-spritesheet.png"),this.TextureRepository.DemonDoor=e.loadTexture("./assets/sprites/enemies/demondoor-spritesheet.png"),this.TextureRepository.Homework=e.loadTexture("./assets/sprites/enemies/homework-spritesheet.png"),this.TextureRepository.FourEyesBug=e.loadTexture("./assets/sprites/enemies/4eyebug-spritesheet.png"),this.TextureRepository.Ghost=e.loadTexture("./assets/sprites/enemies/ghost-spritesheet.png")}addEnemy(e){let i,s=this.getRandomPositionAtScreemBorder(0,T.x,0,T.y,32),r=w.toWorldSpace(s);switch(e){case 4:i=new Tt(r.x,r.y),i.textureId=this.TextureRepository.Ghost;break;case 0:i=new St(r.x,r.y),i.textureId=this.TextureRepository.Clown;break;case 1:i=new Ft(r.x,r.y),i.textureId=this.TextureRepository.DemonDoor;break;case 2:i=new At(r.x,r.y),i.textureId=this.TextureRepository.Homework;break;case 3:i=new Ct(r.x,r.y),i.textureId=this.TextureRepository.FourEyesBug;break;default:throw new Error(`Invalid enemy type: ${e}`)}return i.id=this.id_counter++,this.enemies.push(i),i}remove(e){let i=this.enemies.findIndex(s=>s.id===e.id);return i>-1?(this.enemies.splice(i,1),!0):!1}update(e){for(var i=this.enemies.length;i--;)this.enemies[i].update(e)}fixedUpdate(e,i,s){this.clear();let r=[];for(var o=this.enemies.length;o--;){if(this.enemies[o].isAlive()==!1){r.push(this.enemies[o]);continue}this.enemies[o].setDirection(i.position),this.enemies[o].fixedUpdate(e),this.insert(this.enemies[o])}for(var n=r.length;n--;){let h=r[n];s.add(0,h.position.clone()),this.remove(h)}}render(){let e=w.getClippingAABB(),i=new D({x:e.min.x,y:e.min.y,width:e.max.x-e.min.x,height:e.max.y-e.min.y});this.intersects(i).forEach(s=>{let r=s,o=r.direction.x==-1,h=r.tileIndex*r.tileSize.x,a=h+r.tileSize.x,c=0,l=r.tileSize.y,m=S.getInstance().getTexture(r.textureId);m.startx=o?a:h,m.endx=o?h:a,m.starty=c,m.endy=l,m.width=r.tileSize.x,m.height=r.tileSize.y;let u=w.toScreenSpace(r.position).sub(r.tileSize.clone().divideScalar(2));m.draw(u.x,u.y)})}clearAll(){this.enemies=[]}getRandonEnemy(){if(this.enemies.length==0)return null;let e=ce(0,this.enemiesCounter-1);return this.enemies[e]}};var Bt=class{};var It=class extends G{constructor(){super(),Sound.setVolume(80)}loadMusic(t){return Sound.load(t)}playMusic(t){Sound.play(t)}stopMusic(t){Sound.pause(t)}repeat(t){Sound.repeat(t)}};var Pt=class extends Bt{constructor(){super();this.levelBackgroundTexId=0;this.song=0;this.levelName="Level 1",this.levelId=1,this.levelWidth=2500,this.levelHeight=2500;let e=S.getInstance();this.levelBackgroundTexId=e.loadTexture("./assets/sprites/levels/level-1/background.png");let i=S.getInstance().getTexture(this.levelBackgroundTexId);i.width=this.levelWidth,i.height=this.levelHeight,this.audioController=It.getInstance(),this.audioController.repeat(!0),this.song=this.audioController.loadMusic("./assets/audio/music/kim-lightyear-legends.wav"),this.audioController.playMusic(this.song)}render(){let e=S.getInstance().getTexture(this.levelBackgroundTexId),i=new x(-(this.levelWidth/2),-(this.levelHeight/2)),s=w.toScreenSpace(i);e.draw(s.x,s.y)}update(e){}fixedUpdate(e){}};var Dt=class{constructor(){this.weapons=[];this.projectiles=[];this.projectilesHasChanged=!1}get projectilesCount(){return this.projectiles.length}getProjectiles(){return this.projectiles}registerWeapon(t){this.weapons.push(t)}unregisterEnemy(t){let e=this.weapons.findIndex(i=>i.getType()===t.getType());e>-1&&this.weapons.splice(e,1)}removeProjectile(t){t.markAsExpired(),this.projectilesHasChanged=!0}removeExpiredProjectiles(){this.projectiles=this.projectiles.filter(t=>t.isExpired()===!1)}update(t){let e=this.weapons.length;for(;e--;)this.weapons[e].update(t),this.weapons[e].isReady()&&this.onWeaponRady(this.weapons[e]);for(e=this.projectiles.length;e--;)this.projectiles[e].update(t)}attack(t,e,i){this.projectiles.push(t.attack(e,i))}fixedUpdate(t){for(let i=0;i<this.weapons.length;i++)this.weapons[i].fixedUpdate(t);let e=w.getClippingAABB();for(let i=0;i<this.projectiles.length;i++){let s=this.projectiles[i];if(s.fixedUpdate(t),!e.intersectsBox(s.aabb)){s.markAsExpired(),this.projectilesHasChanged=!0;continue}}this.projectilesHasChanged&&this.removeExpiredProjectiles()}render(){for(let t=0;t<this.projectiles.length;t++)this.projectiles[t].draw()}clearAll(){this.weapons=[],this.projectiles=[]}};var vt=class{constructor(t,e,i,s,r){this.name=t,this.damage=e,this.cooldown=i,this.range=s,this.speed=r}getType(){return this.type}getStats(){return`Name: ${this.name}, Damage: ${this.damage}, Cooldown: ${this.cooldown}s, Range: ${this.range}`}reduceCooldown(t){this.cooldown>0&&(this.cooldown=Math.max(0,this.cooldown-t))}isReady(){return this.cooldown<=0}};var Vt=class{constructor(t,e,i){this.textureId=-1;this.expired=!1;this.direction=new x(0,0);this.position=new x(0,0);this.damage=t,this.range=e,this.speed=i}isExpired(){return this.expired}markAsExpired(){this.expired=!0}markAsUnexpired(){this.expired=!1}getDamage(){return this.damage}getImpact(){return new x(-25,-25)}};var Rt=class extends Vt{constructor(e,i,s,r){super(i,s,r);this.textureManager=S.getInstance();this.tileSize=new x(32,32);this.halfTileSize=new x(16,16);this.size=new x(10,10);this.aabb=new P(new x(0,0),new x(0,0));this.type=0,this.textureId=e}update(e){}fixedUpdate(e){let i=this.speed*e/1e3;this.position.add(this.direction.clone().multiplyScalar(i)),this.aabb.setFromCenterAndSize(this.position,this.size)}draw(){let e=this.textureManager.getTexture(this.textureId);e.width=this.tileSize.x,e.height=this.tileSize.y;let i=w.toScreenSpace(this.position).sub(this.halfTileSize);e.draw(i.x,i.y)}qtIndex(e){return D.prototype.qtIndex.call({x:this.position.x-this.size.x/2,y:this.position.y-this.size.y/2,width:this.size.x,height:this.size.y},e)}};var Lt=class extends vt{constructor(){super("Ball",10,1500,1,60);this.TextureRepository={Ball:0};this.type=0,this.registerTextures()}registerTextures(){let e=S.getInstance();this.TextureRepository.Ball=e.loadTexture("./assets/sprites/weapons/weapon-basebasell.png")}update(e){this.reduceCooldown(e)}fixedUpdate(e){}resetCooldown(){this.cooldown=2e3}attack(e,i){this.resetCooldown();let s=new Rt(this.TextureRepository.Ball,this.damage,this.range,this.speed);return s.position=e.clone(),s.direction=i.clone().sub(s.position).normalize(),s}};var qt=class extends Et{constructor(e){super();this.tileSize=new x(16,16);this.size=new x(10,10);this.aabb=new P(new x(0,0),new x(0,0));this.speed=10,this.type=0,this.position.copy(e),this.aabb.setFromCenterAndSize(this.position,this.size)}update(e){}fixedUpdate(e){this.attracting&&(this.velocity.addScalar(this.speed*e/1e3).clampScalar(-this.maxVelocity,this.maxVelocity),this.position.add(this.direction.clone().multiply(this.velocity))),this.aabb.setFromCenterAndSize(this.position,this.size)}onCollect(e){e.onCollectXp(10)}};var Nt=class extends W{constructor(){super();this.id_counter=1;this.collectables=[];this.TextureRepository={Coin:0,BlueCoin:0};this.registerTextures()}get counter(){return this.collectables.length}registerTextures(){let e=S.getInstance();this.TextureRepository.Coin=e.loadTexture("./assets/sprites/xp/coin.png"),this.TextureRepository.BlueCoin=e.loadTexture("./assets/sprites/xp/blue-coin.png")}add(e,i){let s;switch(e){case 0:s=new qt(i),s.textureId=this.TextureRepository.Coin;break;default:throw new Error(`Invalid collectable type: ${e}`)}return s.id=this.id_counter++,this.collectables.push(s),s}remove(e){let i=this.collectables.findIndex(s=>s.id===e);i>-1&&this.collectables.splice(i,1)}update(e){for(let i=0;i<this.collectables.length;i++)this.collectables[i].collected!=!0&&this.collectables[i].update(e)}fixedUpdate(e){this.clear();for(let i=0;i<this.collectables.length;i++)this.collectables[i].collected!=!0&&(this.collectables[i].fixedUpdate(e),this.insert(this.collectables[i]))}render(){for(let e=0;e<this.collectables.length;e++){let i=this.collectables[e];if(i.collected==!0)continue;let s=S.getInstance().getTexture(i.textureId);s.width=i.tileSize.x,s.height=i.tileSize.y;let r=w.toScreenSpace(i.position).sub(i.size.clone().divideScalar(2));s.draw(r.x,r.y)}}clearAll(){this.collectables=[]}};var Xt=class extends zt{constructor(){super();this.level=new Pt;this.max_enemies=50;this.enemiesController=new kt,this.weaponsController=new Dt,this.collectableController=new Nt,this.player=new Mt,this.player.onLeveUp=()=>{console.log("Level up! lvl: ",this.player.level)},this.weaponsController.registerWeapon(new Lt),this.weaponsController.onWeaponRady=e=>{let i=this.enemiesController.getRandonEnemy();i&&this.weaponsController.attack(e,this.player.position,i.position)},this.spawnEnemiesInterval=os.setInterval(()=>{this.enemiesController.enemiesCounter>=this.max_enemies||this.spawnEnemies(2)},500)}get enemiesCounter(){return this.enemiesController.enemiesCounter}get objectsCount(){return this.enemiesCounter+1}get projectilesCount(){return this.weaponsController.projectilesCount}update(e){this.player.update(e),this.enemiesController.update(e),this.weaponsController.update(e),this.collectableController.update(e),this.level.update(e)}fixedUpdate(e){this.player.fixedUpdate(e),this.enemiesController.fixedUpdate(e,this.player,this.collectableController),this.weaponsController.fixedUpdate(e),this.collectableController.fixedUpdate(e),this.weaponsController.getProjectiles().forEach(s=>{this.enemiesController.intersects(s).forEach(r=>{r.hitBox.intersectsBox(s.aabb)&&(this.weaponsController.removeProjectile(s),r.isAlive()&&(r.takeDamage(s.getDamage()),r.velocity.add(s.getImpact())))})}),this.enemiesController.intersects(this.player).forEach(s=>{s.hitBox.intersectsBox(this.player.hitBox)&&this.player.isAlive()&&this.player.takeDamage(s.damage)});let i=new wt({r:this.player.magnetOrbRange,x:this.player.position.x,y:this.player.position.y});this.collectableController.intersects(i).forEach(s=>{if(s.setDirectionFromTarget(this.player.position),!s.attracting&&this.player.hitBox.clone().expandByScalar(this.player.magnetOrbRange).intersectsBox(s.aabb)){let o=new x(-5,-5);s.velocity.copy(o),s.attracting=!0}s.getExpandedAABB().intersectsBox(this.player.hitBox)&&(s.onCollect(this.player),s.collected=!0,this.collectableController.remove(s.id))}),w.setPosition(this.player.position),this.level.fixedUpdate(e)}render(){this.level.render(),this.player.render(),this.collectableController.render(),this.enemiesController.render(),this.weaponsController.render(),this.player.renderHP(),this.player.renderXP()}spawnEnemies(e){for(let i=0;i<e;i++){let s=Math.floor(Math.random()*5);this.enemiesController.addEnemy(s)}}};he();ee();Screen.setFrameCounter(!0);Screen.setVSync(!1);Camera.position(0,0,0);Camera.type(Camera.LOOKAT);var xe=Color.new(196,224,83,128),Ut=j.getInstance(),$=new Xt;os.setInterval(()=>{Ut.update(d=>{Camera.update(),V.update(),$.update(d)},d=>{$.fixedUpdate(d)},()=>{Screen.clear(xe),$.render(),z.print(5,5,`FPS: ${Ut.FPS} (${Screen.getFPS(10)})`),z.print(5,25,`render: ${Ut.RenderTime.toFixed(2)}ms`),z.print(5,45,`update: ${Ut.UpdateTime.toFixed(2)}ms`),z.print(5,65,`Objects: ${$.objectsCount}`),z.print(5,85,`Projectiles: ${$.projectilesCount}`),z.print(5,T.y-25,`RAM: ${(System.getMemoryStats().used/1e3/1e3).toFixed(4)} / 32.000`),Screen.flip()})},0);})();
/*! use float32; */
